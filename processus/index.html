<!DOCTYPE html>
<html><head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="canonical" href="https://colinmaudry.github.io/decp-docs/processus/">

    <title>
        
        Processus automatisés | Données essentielles de la commande publique
        
    </title>

    
    <link href="https://colinmaudry.github.io/decp-docs/css/fontawesome.min.css" rel="stylesheet">

    
    <link rel="stylesheet" href="https://colinmaudry.github.io/decp-docs/css/ace.min.css">

    
    <link rel="stylesheet" href="https://colinmaudry.github.io/decp-docs/custom.css">

    
    
        
    

</head>
<body><nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow sticky-top" id="navbarMain">
    <div class="container">
        <div>
            <a class="navbar-brand" href="/decp-docs">
                Données essentielles de la commande publique
            </a>
        </div>
        
    </div>
</nav>
<div class="container-fluid">
            <div class="row">

                <div class="docs-sidenav order-0 col-12 col-md-3 col-lg-2 col-xl-2 position-sticky border-right"><nav class="navbar navbar-expand-md navbar-light pl-0">
    <button class="navbar-toggler navbar-toggler-right collapsed" type="button" data-toggle="collapse" data-target="#sidenav-left-collapse" aria-controls="sidenav-left-collapse" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

     <div class="collapse navbar-collapse align-items-start flex-column" id="sidenav-left-collapse">
         <ul class="navbar-nav flex-column pt-3">
    <li data-nav-id="/decp-docs/donnees-publiees/" class="nav-item my-1
        ">
        
        <a class="nav-link p-0" href="/decp-docs/donnees-publiees/"><h6>Données publiées</h6></a>
    </li>
    <li data-nav-id="/decp-docs/schemas/" class="nav-item my-1
        ">
        
        <a class="nav-link p-0" href="/decp-docs/schemas/"><h6>Schémas de données</h6></a>
    </li>
    <li data-nav-id="/decp-docs/publier/" class="nav-item my-1
        ">
        
        <a class="nav-link p-0" href="/decp-docs/publier/"><h6>Publier ses données essentielles</h6></a>
    </li>
    <li data-nav-id="/decp-docs/consolidation-donnees/" class="nav-item my-1
        ">
        
        <a class="nav-link p-0" href="/decp-docs/consolidation-donnees/"><h6>Consolidation et traitement des données</h6></a>
    </li>
    <li data-nav-id="/decp-docs/processus/" class="nav-item my-1 parent active
        ">
        
        <a class="nav-link p-0" href="/decp-docs/processus/"><h6>Processus automatisés</h6></a>
    </li>
    <li data-nav-id="/decp-docs/declarer-profil-acheteur/" class="nav-item my-1
        ">
        
        <a class="nav-link p-0" href="/decp-docs/declarer-profil-acheteur/"><h6>Déclarer un profil d&#39;acheteur</h6></a>
    </li>
    <li data-nav-id="/decp-docs/contact/" class="nav-item my-1
        ">
        
        <a class="nav-link p-0" href="/decp-docs/contact/"><h6>Contact</h6></a>
    </li>
        </ul>
    </div>
</nav>


</div>
                <div class="docs-toc large order-lg-2 order-md-0 order-xs-1 col-12 col-lg-2 col-xl-2 position-sticky border-left"><div class="docs-toc">
	<nav id="TableOfContents">
  <ul>
    <li><a href="#decp-gw">decp-gw</a></li>
    <li><a href="#decp-rama">decp-rama</a></li>
    <li><a href="#decp-monitoring">decp-monitoring</a></li>
  </ul>
</nav>
</div>
</div>
                <div class="main col-12 order-1 col-md-9 col-lg-10 col-xl-8 py-3">
                

<h1>Processus automatisés</h1>

<h2 id="decp-gw">decp-gw</h2>
<p><strong>Description</strong> : téléchargement des données PES marché de la DGFiP et publication sur files.data.gouv.fr</p>
<p><strong>Code source</strong> :</p>
<ul>
<li>hébergement : Gitlab de la mission Etalab</li>
<li>langages :
<ul>
<li>bash</li>
<li>xslt</li>
</ul>
</li>
<li>publicité : confidentiel (contient des données de configuration)</li>
</ul>
<p><strong>Exécution</strong> :</p>
<ul>
<li>serveur : VPS loué par la mission Etalab, Debian Linux 4.9, 8 GB RAM</li>
<li>fréquence : tous les jours à 0:45 CET</li>
<li>durée :
<ul>
<li>moyenne : 5 minutes</li>
</ul>
</li>
</ul>
<p><strong>Actions</strong> :</p>
<!-- Méthode d'inclusion utilisée : dans draw.io, faites File/Export as.../HTML, et ne gardez que <div> et          <script> -->
<body><div class="mxgraph" style="max-width:100%;border:1px solid transparent;" data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;resize&quot;:true,&quot;toolbar&quot;:&quot;zoom layers lightbox&quot;,&quot;edit&quot;:&quot;_blank&quot;,&quot;xml&quot;:&quot;&lt;mxfile host=\&quot;app.diagrams.net\&quot; modified=\&quot;2020-09-07T16:03:21.249Z\&quot; agent=\&quot;5.0 (X11)\&quot; etag=\&quot;B_iVuNBz-7iAvqzI__Am\&quot; version=\&quot;13.6.6\&quot; type=\&quot;device\&quot;&gt;&lt;diagram id=\&quot;YwVPcnQrtgQc1rpSdtJS\&quot; name=\&quot;Page-1\&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;&quot;}"></div>
<ol>
<li>ouverture d&rsquo;un tunnel VPN vers la DGFiP</li>
<li>téléchargement des données disponibles sur le serveur FTP (les données sont supprimées du serveur FTP après téléchargement)</li>
<li>archivage des fichiers XML</li>
<li>correction des anomalies et suppression des champs non pertinents</li>
<li>extraction et enregistrement dans un CSV des SIRETs et URL des profils d&rsquo;acheteurs trouvés dans les fichiers</li>
<li>fusion de l&rsquo;ensemble des XML dans un seuil fichier <code>dgfip-pes-decp.xml</code></li>
<li>publication des nouveaux fichiers et du nouveau <code>dgfip-pes-decp.xml</code> sur <a href="https://files.data.gouv.fr/decp/">files.data.gouv.fr</a> avec <code>rsync</code> (<a href="https://www.data.gouv.fr/fr/datasets/donnees-essentielles-de-la-commande-publique-transmises-via-le-pes-marche/">jeu de données</a>)</li>
</ol>
<h2 id="decp-rama">decp-rama</h2>
<p><strong>Description</strong> : téléchargement des DECP publiques et publication sur data.gouv.fr</p>
<p><strong>Code source</strong> :</p>
<ul>
<li>hébergement : compte Github du Ministère de l&rsquo;économie, des finances et de la relance (<a href="https://github.com/139bercy/decp-rama">https://github.com/139bercy/decp-rama</a>)</li>
<li>langages :
<ul>
<li>bash</li>
<li>xslt</li>
<li><a href="https://stedolan.github.io/jq/">jq</a></li>
</ul>
</li>
<li>publicité : public, licence MIT</li>
</ul>
<p><strong>Exécution</strong> :</p>
<ul>
<li>serveur : instance gratuite de CircleCI (<a href="https://app.circleci.com/pipelines/github/139bercy/decp-rama">journaux</a>)</li>
<li>fréquence : du mardi au samedi, à 4:00 CET</li>
<li>durée :
<ul>
<li>moyenne : 50 minutes</li>
<li>maximale : 4 heures</li>
</ul>
</li>
</ul>
<p><strong>Actions</strong> :</p>
<!-- Méthode d'inclusion utilisée : dans draw.io, faites File/Export as.../HTML, et ne gardez que <div> et <script> -->
<div class="mxgraph" style="max-width:100%;border:1px solid transparent;" data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;resize&quot;:true,&quot;toolbar&quot;:&quot;zoom layers lightbox&quot;,&quot;edit&quot;:&quot;_blank&quot;,&quot;xml&quot;:&quot;&lt;mxfile host=\&quot;app.diagrams.net\&quot; modified=\&quot;2020-09-07T17:08:05.762Z\&quot; agent=\&quot;5.0 (X11)\&quot; etag=\&quot;QpLtG7T-0ZlfYNtpFp3x\&quot; version=\&quot;13.6.6\&quot; type=\&quot;github\&quot;&gt;&lt;diagram id=\&quot;YwVPcnQrtgQc1rpSdtJS\&quot; name=\&quot;Page-1\&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;&quot;}"></div>
<script type="text/javascript" src="https://app.diagrams.net/js/viewer-static.min.js"></script>
<p><strong>a.</strong> Pour chaque source de données répertoriée :</p>
<ol>
<li>téléchargement</li>
<li>correction des anomalies</li>
<li>si la source est en XML, conversion vers JSON</li>
<li>fusion de l&rsquo;ensemble des fichiers de la source en un seul fichier JSON</li>
</ol>
<p><strong>b.</strong> Puis, opérations sur les données consolidées :</p>
<ol>
<li>consolidation des données de toutes les sources</li>
<li>déduplication des marchés par <code>uid</code> (SIRET + <code>id</code>)</li>
<li>exclusion des marchés inexploitables</li>
<li>correction des anomalies globales (présentes dans plusieurs sources)</li>
<li>production de statistiques</li>
<li>extraction des nouveaux marchés du jour (c&rsquo;est de loin l&rsquo;étape la plus chronophage, dont la durée dépend du nombre de nouveaux marchés)</li>
<li>conversion du fichier consolidé et du fichier du jour en XML</li>
<li>conversion du fichier consolidé au format OCDS JSON</li>
<li>publication des données sur data.gouv.fr via l&rsquo;API data.gouv.fr (<a href="https://www.data.gouv.fr/fr/datasets/5cd57bf68b4c4179299eb0e9/">jeu de données</a>)</li>
</ol>
<ul>
<li>les fichiers consolidés JSON, XML et OCDS JSON remplacent les versions précédentes</li>
<li>les fichiers du jour JSON et XML sont ajoutés</li>
</ul>
<h2 id="decp-monitoring">decp-monitoring</h2>
<p>TODO</p>


    


                    
                    <div class="row"><div class="position-relative mx-auto col-lg-9">
                          <div class="bg-primary overflow-hidden p-3 mt-5 shadow">

    <h4 class="text-white text-center">Read more</h4>

    <div class="d-flex justify-content-center"><a class="p-1 mr-3 d-inline-block text-white" href="/decp-docs/consolidation-donnees/" title="Consolidation et traitement des données"><i class="fas fa-chevron-left p-1"></i>Consolidation et traitement des données</a>
        <a class="p-1 ml-3 d-inline-block text-white text-right" href="/decp-docs/declarer-profil-acheteur/" title="Déclarer un profil d&#39;acheteur">Déclarer un profil d&#39;acheteur<i class="fas fa-chevron-right p-1"></i></a>
    </div>
</div>


                        </div></div> 

                </div>

            </div> 

        </div> 
<script src="https://colinmaudry.github.io/decp-docs/lib/jquery.min.js"></script> 
<script src="https://colinmaudry.github.io/decp-docs/lib/popper.min.js"></script> 

<script src="https://colinmaudry.github.io/decp-docs/js/bootstrap.min.js"></script> 


<script type="text/javascript" src="/decp-docs/plugins/lunr.min.js"></script>
<script type="text/javascript" src="/decp-docs/plugins/auto-complete.js"></script>
<link href="/decp-docs/plugins/auto-complete.css" rel="stylesheet">
<script type="text/javascript">
  
      var baseurl = "https:\/\/colinmaudry.github.io\/decp-docs\/";
  
</script>
<script type="text/javascript" src="/decp-docs/plugins/search.js"></script>


<script type="text/javascript" src="/decp-docs/plugins/clipboard.js"></script>
<script>
  new ClipboardJS('.btn');
</script>
</body>
</html>
